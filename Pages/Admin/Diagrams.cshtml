@page
@model AppManager.Pages.Admin.DiagramsModel
@{
    ViewData["Title"] = "System Diagramme";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>üìä System Diagramme</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a asp-page="/Index">Home</a></li>
                        <li class="breadcrumb-item"><a asp-page="/Admin/Dashboard">Admin</a></li>
                        <li class="breadcrumb-item active">Diagramme</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="diagramTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="usecase-tab" data-bs-toggle="tab" data-bs-target="#usecase"
                type="button" role="tab">
                ÔøΩ Use Case Diagramm
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button"
                role="tab">
                üîÑ Aktivit√§tsdiagramm
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="navigation-tab" data-bs-toggle="tab" data-bs-target="#navigation" type="button"
                role="tab">
                ÔøΩÔ∏è Navigation Flow
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="architecture-tab" data-bs-toggle="tab" data-bs-target="#architecture" type="button"
                role="tab">
                üèóÔ∏è System Architektur
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="diagramTabContent">

        <!-- Use Case Diagram -->
        <div class="tab-pane fade show active" id="usecase" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üë• Use Case Diagramm - AppManager v2.2</h4>
                    <small class="text-muted">Benutzerrollen und Systemfunktionen mit neuer Navigation</small>
                </div>
                <div class="card-body">
                    <div class="mermaid" id="usecase-diagram">
                        graph TB
                            %% Akteure
                            User[üë§ App Owner<br/>Benutzer]
                            Admin[üë®‚Äçüíº Administrator<br/>Global Admin]
                            SuperAdmin[üîß Super Admin<br/>System Admin]
                            
                            %% System Boundary
                            subgraph AppManager["üéØ AppManager System v2.2"]
                                
                                %% Navigation Use Cases
                                subgraph Navigation["üó∫Ô∏è Navigation Hub"]
                                    Dashboard[üè† Dashboard<br/>√úbersicht]
                                    NavWinApps[üì± Navigate to<br/>Windows Apps]
                                    NavIISApps[üöÄ Navigate to<br/>IIS AppPools]
                                end
                                
                                %% Windows App Management
                                subgraph WindowsApps["üì± Windows App Management"]
                                    StartWinApp[‚ñ∂Ô∏è Start<br/>Windows App]
                                    StopWinApp[‚èπÔ∏è Stop<br/>Windows App]
                                    RestartWinApp[üîÅ Restart<br/>Windows App]
                                    AddWinApp[‚ûï Add<br/>Windows App]
                                    DeleteWinApp[üóëÔ∏è Delete<br/>Windows App]
                                end
                                
                                %% IIS Management  
                                subgraph IISManagement["üöÄ IIS AppPool Management"]
                                    StartAppPool[‚ñ∂Ô∏è Start<br/>AppPool]
                                    StopAppPool[‚èπÔ∏è Stop<br/>AppPool]
                                    RecycleAppPool[‚ôªÔ∏è Recycle<br/>AppPool]
                                    MonitorCPU[üìä Monitor<br/>CPU Usage]
                                    AnalyzePeaks[‚è∞ Analyze<br/>Peak Times]
                                end
                                
                                %% Admin Functions
                                subgraph AdminFunctions["üîê Admin Functions"]
                                    ManageUsers[üë• Manage<br/>Users]
                                    ManageOwnership[üîë Manage<br/>App Ownership]
                                    ViewHistory[üìú View<br/>History]
                                    ViewDiagrams[üìä View<br/>Diagrams]
                                    SwitchRole[üîÑ Switch<br/>Role]
                                end
                                
                                %% Authentication
                                Login[üîê Login/<br/>Logout]
                            end
                            
                            %% Beziehungen - User
                            User --> Login
                            User --> Dashboard
                            User --> NavWinApps
                            User --> NavIISApps
                            User --> StartWinApp
                            User --> StopWinApp
                            User --> RestartWinApp
                            User --> StartAppPool
                            User --> StopAppPool
                            User --> RecycleAppPool
                            User --> MonitorCPU
                            User --> AnalyzePeaks
                            
                            %% Beziehungen - Admin
                            Admin --> Login
                            Admin --> Dashboard
                            Admin --> NavWinApps
                            Admin --> NavIISApps
                            Admin --> StartWinApp
                            Admin --> StopWinApp
                            Admin --> RestartWinApp
                            Admin --> StartAppPool
                            Admin --> StopAppPool
                            Admin --> RecycleAppPool
                            Admin --> MonitorCPU
                            Admin --> AnalyzePeaks
                            Admin --> AddWinApp
                            Admin --> DeleteWinApp
                            Admin --> ManageOwnership
                            Admin --> ViewHistory
                            Admin --> ViewDiagrams
                            Admin --> SwitchRole
                            
                            %% Beziehungen - SuperAdmin
                            SuperAdmin --> Login
                            SuperAdmin --> Dashboard
                            SuperAdmin --> NavWinApps
                            SuperAdmin --> NavIISApps
                            SuperAdmin --> StartWinApp
                            SuperAdmin --> StopWinApp
                            SuperAdmin --> RestartWinApp
                            SuperAdmin --> StartAppPool
                            SuperAdmin --> StopAppPool
                            SuperAdmin --> RecycleAppPool
                            SuperAdmin --> MonitorCPU
                            SuperAdmin --> AnalyzePeaks
                            SuperAdmin --> AddWinApp
                            SuperAdmin --> DeleteWinApp
                            SuperAdmin --> ManageUsers
                            SuperAdmin --> ManageOwnership
                            SuperAdmin --> ViewHistory
                            SuperAdmin --> ViewDiagrams
                            SuperAdmin --> SwitchRole
                            
                            %% Styling
                            classDef actor fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
                            classDef navigation fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
                            classDef windows fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
                            classDef iis fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
                            classDef admin fill:#ffebee,stroke:#b71c1c,stroke-width:2px,color:#000
                            classDef auth fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#000
                            
                            class User,Admin,SuperAdmin actor
                            class Dashboard,NavWinApps,NavIISApps navigation
                            class StartWinApp,StopWinApp,RestartWinApp,AddWinApp,DeleteWinApp windows
                            class StartAppPool,StopAppPool,RecycleAppPool,MonitorCPU,AnalyzePeaks iis
                            class ManageUsers,ManageOwnership,ViewHistory,ViewDiagrams,SwitchRole admin
                            class Login auth
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Diagram -->
        <div class="tab-pane fade" id="activity" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üîÑ Aktivit√§tsdiagramm - IIS AppPool Management</h4>
                    <small class="text-muted">Workflow f√ºr AppPool-Verwaltung mit CPU-Monitoring</small>
                </div>
                <div class="card-body">
                    <div class="mermaid" id="activity-diagram">
                        flowchart TD
                            Start([üöÄ Start: User √∂ffnet IISManager])
                            
                            %% Authentication
                            Auth{üîê Authentifiziert?}
                            Login[üîë Login erforderlich]
                            
                            %% Load Page
                            LoadPage[üìÑ Lade IISManager Seite]
                            LoadAppPools[üîç Lade AppPool Liste]
                            LoadCPU[üìä Lade CPU Daten mit<br/>PerformanceCounter]
                            
                            %% Display
                            DisplayData[üñ•Ô∏è Zeige AppPools mit<br/>CPU-Auslastung & Peak-Zeiten]
                            
                            %% User Actions
                            UserAction{üë§ Benutzer Aktion?}
                            
                            %% Actions
                            StartAction[‚ñ∂Ô∏è Start AppPool]
                            StopAction[‚èπÔ∏è Stop AppPool]
                            RecycleAction[‚ôªÔ∏è Recycle AppPool]
                            RefreshAction[üîÑ Refresh Data]
                            
                            %% Authorization Check
                            AuthCheck{üîê Berechtigung<br/>vorhanden?}
                            AuthError[‚ùå Keine Berechtigung<br/>Fehlermeldung]
                            
                            %% Action Processing
                            ProcessAction[‚öôÔ∏è F√ºhre IIS Aktion aus<br/>mit Microsoft.Web.Administration]
                            
                            %% Action Result
                            ActionResult{‚úÖ Aktion<br/>erfolgreich?}
                            Success[‚úÖ Erfolgsmeldung<br/>+ Log Eintrag]
                            Error[‚ùå Fehlermeldung<br/>+ Error Log]
                            
                            %% Update Display
                            UpdateCPU[üìä Aktualisiere CPU-Daten<br/>& Peak-Zeit Analyse]
                            UpdateStatus[üîÑ Aktualisiere AppPool Status]
                            
                            %% Auto Refresh
                            AutoRefresh{‚è±Ô∏è Auto-Refresh<br/>aktiv?}
                            Wait[‚è≥ Warte 5 Sekunden]
                            
                            End([üèÅ Ende])
                            
                            %% Flow
                            Start --> Auth
                            Auth -->|Nein| Login
                            Login --> Auth
                            Auth -->|Ja| LoadPage
                            
                            LoadPage --> LoadAppPools
                            LoadAppPools --> LoadCPU
                            LoadCPU --> DisplayData
                            
                            DisplayData --> UserAction
                            
                            UserAction -->|Start| StartAction
                            UserAction -->|Stop| StopAction  
                            UserAction -->|Recycle| RecycleAction
                            UserAction -->|Refresh| RefreshAction
                            UserAction -->|Auto-Refresh| AutoRefresh
                            UserAction -->|Beenden| End
                            
                            StartAction --> AuthCheck
                            StopAction --> AuthCheck
                            RecycleAction --> AuthCheck
                            RefreshAction --> LoadCPU
                            
                            AuthCheck -->|Nein| AuthError
                            AuthCheck -->|Ja| ProcessAction
                            
                            ProcessAction --> ActionResult
                            
                            ActionResult -->|Ja| Success
                            ActionResult -->|Nein| Error
                            
                            Success --> UpdateCPU
                            Error --> UpdateCPU
                            AuthError --> UserAction
                            
                            UpdateCPU --> UpdateStatus
                            UpdateStatus --> DisplayData
                            
                            AutoRefresh -->|Ja| Wait
                            AutoRefresh -->|Nein| UserAction
                            Wait --> LoadCPU
                            
                            %% Styling
                            classDef startEnd fill:#e8f5e8,stroke:#1b5e20,stroke-width:3px,color:#000
                            classDef process fill:#e3f2fd,stroke:#0277bd,stroke-width:2px,color:#000
                            classDef decision fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
                            classDef action fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
                            classDef error fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000
                            classDef success fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,color:#000
                            
                            class Start,End startEnd
                            class LoadPage,LoadAppPools,LoadCPU,DisplayData,ProcessAction,UpdateCPU,UpdateStatus,Wait process
                            class Auth,UserAction,AuthCheck,ActionResult,AutoRefresh decision
                            class StartAction,StopAction,RecycleAction,RefreshAction,Login action
                            class AuthError,Error error
                            class Success success
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Flow -->
        <div class="tab-pane fade" id="navigation" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üó∫Ô∏è Navigation Flow - UX Struktur v2.2</h4>
                    <small class="text-muted">3-Stufen Navigation f√ºr bessere Benutzerf√ºhrung</small>
                </div>
                <div class="card-body">
                    <div class="mermaid" id="navigation-diagram">
                        flowchart TD
                            %% Entry Points
                            Login[üîê Login Page<br/>admin@appmanager.local]
                            
                            %% Main Navigation Hub
                            Dashboard[üè† Dashboard<br/>ReadOnly √úbersicht<br/>+ Navigation Hub]
                            
                            %% Main Routes
                            WinAppsPage[üì± ApplicationManagement<br/>Windows Apps Verwaltung]
                            IISPage[üöÄ IISManager<br/>AppPool Verwaltung + CPU Monitoring]
                            
                            %% Windows App Functions
                            subgraph WinAppFunctions["üì± Windows App Functions"]
                                WinStart[‚ñ∂Ô∏è Start Windows App]
                                WinStop[‚èπÔ∏è Stop Windows App] 
                                WinRestart[üîÅ Restart Windows App]
                                WinAdd[‚ûï Add New App]
                                WinDelete[üóëÔ∏è Delete App]
                                IISRedirect[üöÄ IIS Manager Button<br/>f√ºr IIS Apps]
                            end
                            
                            %% IIS Functions
                            subgraph IISFunctions["üöÄ IIS AppPool Functions"]
                                IISStart[‚ñ∂Ô∏è Start AppPool]
                                IISStop[‚èπÔ∏è Stop AppPool]
                                IISRecycle[‚ôªÔ∏è Recycle AppPool]
                                CPUMonitor[üìä CPU Monitoring<br/>PerformanceCounter]
                                PeakAnalysis[‚è∞ Peak-Zeit Analyse<br/>Morgen/Mittag/Abend/Nacht]
                                AutoRefresh[üîÑ Auto-Refresh<br/>alle 5 Sekunden]
                            end
                            
                            %% Admin Functions
                            subgraph AdminArea["üîê Admin Area (nur Admin/SuperAdmin)"]
                                Users[üë• Users Management]
                                Ownership[üîë App Ownership]
                                History[üìú Action History]
                                Diagrams[üìä System Diagrams]
                                SwitchRole[üîÑ Role Switching]
                            end
                            
                            %% Flow - Main Navigation
                            Login --> Dashboard
                            
                            %% Dashboard Navigation Buttons (schwarze R√§nder + rote Schatten)
                            Dashboard -->|üì± Windows Apps Button| WinAppsPage
                            Dashboard -->|üöÄ IIS AppPools Button| IISPage
                            Dashboard -->|üìä Diagramme Button<br/>(nur Admin)| Diagrams
                            Dashboard -->|üë§ App-Owner Button<br/>(nur Admin)| Ownership
                            Dashboard -->|üìú History Button<br/>(nur Admin)| History
                            
                            %% Windows App Page Functions
                            WinAppsPage --> WinStart
                            WinAppsPage --> WinStop
                            WinAppsPage --> WinRestart
                            WinAppsPage --> WinAdd
                            WinAppsPage --> WinDelete
                            WinAppsPage --> IISRedirect
                            
                            %% IIS Redirect
                            IISRedirect -->|Weiterleitung| IISPage
                            
                            %% IIS Page Functions
                            IISPage --> IISStart
                            IISPage --> IISStop
                            IISPage --> IISRecycle
                            IISPage --> CPUMonitor
                            IISPage --> PeakAnalysis
                            IISPage --> AutoRefresh
                            
                            %% Admin Navigation
                            Dashboard --> Users
                            Dashboard --> Ownership
                            Dashboard --> History
                            Dashboard --> Diagrams
                            Dashboard --> SwitchRole
                            
                            %% Return Navigation
                            WinAppsPage -.->|Breadcrumb| Dashboard
                            IISPage -.->|Breadcrumb| Dashboard
                            Users -.->|Breadcrumb| Dashboard
                            Ownership -.->|Breadcrumb| Dashboard
                            History -.->|Breadcrumb| Dashboard
                            Diagrams -.->|Breadcrumb| Dashboard
                            
                            %% Styling
                            classDef entry fill:#e8f5e8,stroke:#1b5e20,stroke-width:3px,color:#000
                            classDef hub fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#000
                            classDef main fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
                            classDef windows fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
                            classDef iis fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
                            classDef admin fill:#ffebee,stroke:#b71c1c,stroke-width:2px,color:#000
                            classDef button fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#000
                            
                            class Login entry
                            class Dashboard hub
                            class WinAppsPage,IISPage main
                            class WinStart,WinStop,WinRestart,WinAdd,WinDelete windows
                            class IISStart,IISStop,IISRecycle,CPUMonitor,PeakAnalysis,AutoRefresh iis
                            class Users,Ownership,History,Diagrams,SwitchRole admin
                            class IISRedirect button
                    </div>
                </div>
            </div>
        </div>

        <!-- System Architecture -->
        <div class="tab-pane fade" id="architecture" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">üèóÔ∏è System Architektur - Simplified Design v2.2</h4>
                    <small class="text-muted">Technische Architektur mit direkter IIS Integration</small>
                </div>
                <div class="card-body">
                    <div class="mermaid" id="architecture-diagram">
                        graph TB
                            %% Client Layer
                            subgraph Client["üë§ Client Layer"]
                                Browser[üåê Web Browser<br/>Chrome/Edge/Firefox]
                                User[üë§ Benutzer<br/>App Owner/Admin]
                            end
                            
                            %% Presentation Layer
                            subgraph Presentation["üñ•Ô∏è Presentation Layer (ASP.NET Core)"]
                                Dashboard[üè† Dashboard.cshtml<br/>ReadOnly √úbersicht]
                                AppMgmt[üì± ApplicationManagement.cshtml<br/>Windows Apps + IIS Weiterleitung]
                                IISMgr[üöÄ IISManager.cshtml<br/>AppPool + CPU Monitoring]
                                AdminPages[üîê Admin Pages<br/>Users/Ownership/History]
                                
                                Layout[üìê _Layout.cshtml<br/>Navigation + Styling]
                                CSS[üé® site.css<br/>Pistazien-Gr√ºn + Button Styling]
                            end
                            
                            %% Controller Layer
                            subgraph Controllers["üéÆ Controller Layer"]
                                PageModels[üìÑ PageModel Classes<br/>Dashboard/ApplicationManagement/IISManager]
                                Auth[üîê Authentication<br/>ASP.NET Core Identity]
                                Authorization[üîë Authorization<br/>Role-based + Ownership]
                            end
                            
                            %% Business Logic
                            subgraph Business["‚öôÔ∏è Business Logic Layer"]
                                AppService[üîß AppService.cs<br/>Simplified IIS Integration]
                                ProgramMgr[üíª ProgramManagerService.cs<br/>Windows App Management]
                                EmailService[üìß ConsoleEmailSender.cs<br/>Notification Service]
                            end
                            
                            %% Data Layer
                            subgraph Data["üóÑÔ∏è Data Layer"]
                                EF[üìä Entity Framework Core<br/>ORM + Migrations]
                                SQLite[üíæ SQLite Database<br/>local.db (Foreign Keys disabled)]
                                Models[üìã Data Models<br/>Application/User/History]
                            end
                            
                            %% External Systems
                            subgraph External["üîå External Systems"]
                                IIS[üåê IIS (Internet Information Services)<br/>Microsoft.Web.Administration]
                                WinSystem[üíª Windows System<br/>Process Management]
                                PerfCounter[üìä PerformanceCounter<br/>CPU Monitoring]
                            end
                            
                            %% Deployment
                            subgraph Deployment["üöÄ Deployment"]
                                SelfContained[üì¶ Self-Contained Publish<br/>win-x64]
                                IISWebsite[üåê IIS Website<br/>AppManagerPool (LocalSystem)]
                                Files[üìÅ Published Files<br/>C:/Users/silav/Desktop/iismanager]
                            end
                            
                            %% Connections
                            User --> Browser
                            Browser --> Dashboard
                            Browser --> AppMgmt
                            Browser --> IISMgr
                            Browser --> AdminPages
                            
                            Dashboard --> PageModels
                            AppMgmt --> PageModels
                            IISMgr --> PageModels
                            AdminPages --> PageModels
                            
                            PageModels --> Auth
                            PageModels --> Authorization
                            PageModels --> AppService
                            PageModels --> ProgramMgr
                            
                            AppService --> IIS
                            ProgramMgr --> WinSystem
                            IISMgr --> PerfCounter
                            
                            PageModels --> EF
                            EF --> SQLite
                            EF --> Models
                            
                            Layout --> CSS
                            
                            SelfContained --> IISWebsite
                            IISWebsite --> Files
                            
                            %% Styling
                            classDef client fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
                            classDef presentation fill:#e3f2fd,stroke:#0277bd,stroke-width:2px,color:#000
                            classDef controller fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
                            classDef business fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
                            classDef data fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#000
                            classDef external fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
                            classDef deploy fill:#f1f8e9,stroke:#388e3c,stroke-width:2px,color:#000
                            
                            class Browser,User client
                            class Dashboard,AppMgmt,IISMgr,AdminPages,Layout,CSS presentation
                            class PageModels,Auth,Authorization controller
                            class AppService,ProgramMgr,EmailService business
                            class EF,SQLite,Models data
                            class IIS,WinSystem,PerfCounter external
                            class SelfContained,IISWebsite,Files deploy
                    </div>
                </div>
            </div>
        </div>

    </div>


</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        // Mermaid initialisieren mit Pistazien-Gr√ºn Theme
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#bce3ca',
                primaryTextColor: '#2c3e2f',
                primaryBorderColor: '#93c5a0',
                lineColor: '#7fb069',
                secondaryColor: '#a8d4b5',
                tertiaryColor: '#f8f9fa',
                background: '#ffffff',
                mainBkg: '#bce3ca',
                secondBkg: '#a8d4b5',
                tertiaryBkg: '#93c5a0',
                fontFamily: 'Inter, system-ui, sans-serif',
                fontSize: '14px'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            },
            sequence: {
                useMaxWidth: true,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                messageMargin: 35,
                mirrorActors: true
            },
            graph: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        // Tab-Wechsel Event f√ºr Mermaid Neu-Rendering
        document.addEventListener('DOMContentLoaded', function () {
            var tabTriggerList = [].slice.call(document.querySelectorAll('#diagramTabs button[data-bs-toggle="tab"]'));
            tabTriggerList.forEach(function (tabTrigger) {
                tabTrigger.addEventListener('shown.bs.tab', function (event) {
                    var targetId = event.target.getAttribute('data-bs-target');
                    // Re-render Mermaid diagrams when tab is shown
                    setTimeout(function () {
                        try {
                            mermaid.init();
                        } catch (e) {
                            console.log('Mermaid rendering error:', e);
                        }
                    }, 200);
                });
            });

            // Initial render f√ºr alle Diagramme
            setTimeout(function () {
                try {
                    mermaid.init();
                } catch (e) {
                    console.log('Initial mermaid rendering error:', e);
                }
            }, 500);
        });
    </script>
}

<style>
    .mermaid {
        text-align: center;
        margin: 20px 0;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 12px;
        padding: 25px;
        min-height: 400px;
        border: 1px solid #dee2e6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
    }

    .card {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border: none;
        margin-bottom: 25px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
    }

    .card-header {
        background: linear-gradient(135deg, #93c5a0 0%, #a8d4b5 50%, #bce3ca 100%);
        color: #2c3e2f;
        border-bottom: none;
        border-radius: 15px 15px 0 0 !important;
        font-weight: 600;
        padding: 20px;
    }

    .nav-tabs {
        border-bottom: 2px solid #93c5a0;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 10px 10px 0 0;
        padding: 10px 10px 0 10px;
    }

    .nav-tabs .nav-link {
        border: 2px solid #000000 !important;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3), 0 2px 4px rgba(220, 53, 69, 0.2) !important;
        color: #2c3e2f;
        font-weight: 600;
        border-radius: 10px 10px 0 0;
        margin-right: 5px;
        padding: 12px 20px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
    }

    .nav-tabs .nav-link:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4), 0 3px 6px rgba(220, 53, 69, 0.3) !important;
        border-color: #000000 !important;
        background: rgba(188, 227, 202, 0.3);
    }

    .nav-tabs .nav-link.active {
        background: linear-gradient(135deg, #93c5a0 0%, #a8d4b5 100%);
        color: #2c3e2f;
        border: 2px solid #000000 !important;
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4), 0 3px 6px rgba(220, 53, 69, 0.3) !important;
        font-weight: 700;
    }

    .breadcrumb {
        background: rgba(147, 197, 160, 0.2);
        padding: 12px 20px;
        border-radius: 10px;
        backdrop-filter: blur(5px);
    }

    .breadcrumb-item a {
        color: #2c3e2f;
        text-decoration: none;
        font-weight: 500;
    }

    .breadcrumb-item a:hover {
        color: #7fb069;
        text-decoration: underline;
    }

    .breadcrumb-item.active {
        color: #93c5a0;
        font-weight: 600;
    }

    .btn-outline-primary {
        border: 2px solid #000000 !important;
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3), 0 2px 4px rgba(220, 53, 69, 0.2) !important;
        color: #93c5a0;
        font-weight: 600;
        padding: 10px 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
        background-color: #93c5a0;
        border-color: #000000 !important;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4), 0 3px 6px rgba(220, 53, 69, 0.3) !important;
    }

    /* Mermaid Diagramm spezifische Styles */
    .mermaid svg {
        max-width: 100% !important;
        height: auto !important;
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .nav-tabs .nav-link {
            font-size: 12px;
            padding: 8px 12px;
        }
        
        .mermaid {
            padding: 15px;
            min-height: 300px;
        }
        
        .card-header {
            padding: 15px;
        }
    }

    /* Custom Pistazien-Gr√ºn Akzente */
    h2 {
        color: #2c3e2f;
        font-weight: 700;
    }

    h4 {
        color: #2c3e2f;
        font-weight: 600;
    }

    .text-muted {
        color: #6c757d !important;
        font-style: italic;
    }
</style>                                                                                        