<?xml version="1.0" encoding="utf-8"?>
<!--
IIS-optimiertes Publish-Profil für AppManager
Für Deployment auf Windows Server mit IIS
-->
<Project>
  <PropertyGroup>
    <!-- Target -->
    <TargetFramework>net8.0</TargetFramework>
    <RuntimeIdentifier>win-x64</RuntimeIdentifier>

    <!-- IIS-optimierte Einstellungen (nicht self-contained für bessere Performance) -->
    <SelfContained>false</SelfContained>
    <PublishSingleFile>false</PublishSingleFile>
    <PublishReadyToRun>true</PublishReadyToRun>
    <PublishTrimmed>false</PublishTrimmed>

    <!-- Performance-Optimierungen -->
    <DebugType>none</DebugType>
    <DebugSymbols>false</DebugSymbols>
    <GenerateDocumentationFile>false</GenerateDocumentationFile>
    <Optimize>true</Optimize>
    <TieredCompilation>true</TieredCompilation>

    <!-- Sprach-Optimierung -->
    <SatelliteResourceLanguages>de;en</SatelliteResourceLanguages>

    <!-- File system publish nach IIS-Verzeichnis -->
    <PublishProtocol>FileSystem</PublishProtocol>
    <DeleteExistingFiles>true</DeleteExistingFiles>
    <PublishUrl>C:\Users\silav\Desktop\iismanager</PublishUrl>
    <PublishDir>C:\Users\silav\Desktop\iismanager</PublishDir>
    
    <!-- IIS-spezifische Konfiguration -->
    <AspNetCoreHostingModel>InProcess</AspNetCoreHostingModel>
    <AspNetCoreModuleName>AspNetCoreModuleV2</AspNetCoreModuleName>
    <EnvironmentName>Production</EnvironmentName>
    
    <!-- Windows Authentication Support -->
    <UseAppHost>true</UseAppHost>
    <PublishProvider>FileSystem</PublishProvider>
    <WebPublishMethod>FileSystem</WebPublishMethod>
    <LaunchSiteAfterPublish>false</LaunchSiteAfterPublish>
    
    <!-- Build Configuration -->
    <LastUsedBuildConfiguration>Release</LastUsedBuildConfiguration>
    <LastUsedPlatform>Any CPU</LastUsedPlatform>
    <ExcludeApp_Data>false</ExcludeApp_Data>
  </PropertyGroup>
  
  <!-- Zusätzliche Dateien für IIS deployment -->
  <ItemGroup>
    <None Include="web.config">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  
  <!-- Post-build Aktionen für IIS -->
  <Target Name="CreateIISDirectories" AfterTargets="Publish">
    <MakeDir Directories="$(PublishUrl)\logs" Condition="!Exists('$(PublishUrl)\logs')" />
    <MakeDir Directories="$(PublishUrl)\App_Data" Condition="!Exists('$(PublishUrl)\App_Data')" />
  </Target>
  
  <!-- IIS-Berechtigungen setzen (erfordert Admin-Rechte) -->
  <Target Name="SetIISPermissions" AfterTargets="CreateIISDirectories" Condition="'$(OS)' == 'Windows_NT'">
    <Message Text="IIS-Verzeichnisse erstellt. Bitte IIS-Berechtigungen manuell setzen:" Importance="high" />
    <Message Text="- IIS_IUSRS: Vollzugriff auf C:\Users\silav\Desktop\iismanager" Importance="high" />
    <Message Text="- IIS AppPool\AppManagerPool: Vollzugriff auf C:\Users\silav\Desktop\iismanager" Importance="high" />
  </Target>
</Project>